@model System.Collections.Generic.List<WebStudio.Models.Card>
@using WebStudio.Enums
@inject WebStudioContext db

@{
    ViewBag.Title = "Главная страница";
    Layout = "_Layout";
    int newCard = Model.Where(c => c.CardState == CardState.Новая).Count();
    int workCard = Model.Where(c => c.CardState == CardState.Проработка).Count();
    int PKOCard = Model.Where(c => c.CardState == CardState.ПКО).Count();
    int AuctionCard = Model.Where(c => c.CardState == CardState.Торги).Count();
    int WinCard = Model.Where(c => c.CardState == CardState.Выиграна).Count();
    int LoseCard = Model.Where(c => c.CardState == CardState.Проиграна).Count();
    int ActiveCard = Model.Where(c => c.CardState == CardState.Активна).Count();
    int DelCard = Model.Where(c => c.CardState == CardState.Удалена).Count();

    var customProps = "btn btn-light col-lg-12 my-0 shadow-sm d-flex flex-row justify-content-between align-items-center";
    
    var closedCards = @db.Cards.Where(c => c.CardState == CardState.Закрыта).Count();
    var auctionRes = db.AuctionResults.Count();
    var historyRes = db.HistoryOfVictoryAndLosing.Count();
}

<div>
    <div class="container pl-0">
        <div class="row ml-0">
            <div class="col-lg-4 pl-0 pr-0">
                
                <a type="button" class="@customProps" asp-controller="Cards" asp-action="AllCardsList" 
                   asp-route-sort="@CardState.Проиграна"><span>Проигранные </span><span class="badge badge-dark"> @LoseCard</span></a><br>
                
                <a type="button" class="@customProps" asp-controller="Cards" asp-action="AllCardsList" 
                   asp-route-sort="@CardState.Закрыта"><span>Закрытые </span><span class="badge badge-lightcoral"> @closedCards </span></a><br>
                
                <a type="button" class="@customProps" asp-controller="Cards" asp-action="AllCardsList" 
                   asp-route-sort="@CardState.Удалена">Удаленные </a><br>
                
                <a type="button" class="@customProps" asp-controller="AuctionResults" asp-action="Index">
                    <span>Результаты торгов с сайта биржи </span><span class="badge badge-secondary"> @auctionRes </span></a><br>
                
                <a type="button" class="@customProps" asp-controller="Cards" asp-action="AuctionCards">
                    <span>Архив результатов участия на торгах </span><span class="badge badge-secondary"> @historyRes </span></a><br>
                
                <a type="button" class="@customProps" asp-controller="Requests" asp-action="Index">Запросы поставщикам</a><br>

                <a type="button" class="@customProps" asp-controller="Suppliers" asp-action="Index">База поставщиков</a><br>
                
                <a type="button" class="@customProps" asp-controller="Offers" asp-action="Index">Коммерческие предложения</a><br>
                
                <a type="button" class="@customProps">Настройки и ввод постоянных данных</a><br>
            </div>
            
            <div class="col-lg-6">
                <div id="piechart_3d" style="width: 720px; height: 400px;"></div> 
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load("current", {packages:["corechart"]});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Task', 'Hours per Day'],
          ['Новые',     @newCard,],
          ['В проработке',      @workCard],
          ['ПКО',  @PKOCard],
          ['Торги', @AuctionCard],
          ['Выиграные',    @WinCard],
          ['Проиграные',  @LoseCard],
          ['Активные', @ActiveCard],
          ['Удалённые',    @DelCard]
        ]);

        var options = {
          title: 'Статистика карточек',
          is3D: true,
          colors: ['#28A745','#007BFF', '#78866B', '#FFC107', '#17A2B8', '#343A40', '#9400D3', '#DC3545'],
          chartArea: {left:30,top:20,width:'80%',height:'70%'},
          width: 1130,
          height: 800,
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
        chart.draw(data, options);
      }
    </script>
}